asyncapi: 3.0.0
info:
  title: Netflix Streaming Event API
  version: '0.1.0'
  description: |
    This AsyncAPI document defines the event-driven interactions for a Netflix-like
    streaming platform, including user playback events, recommendations, and new content notifications.
servers:
  production:
    host: kafka.streamflix.com
    protocol: kafka
    description: Production Kafka broker.
channels:
  videoPlayback:
    address: 'video/playback_event'
    messages:
      playbackMessage:
        description: Event generated when user interacts with video player
        payload:
          type: object
          required: [userId, action, videoId, timestamp]
          properties:
            userId:
              type: string
            action:
              type: string
              enum: [play, pause, stop, resume]
            videoId:
              type: string
            timestamp:
              type: string
              format: date-time

  videoRecommendation:
    address: 'video/recommendation'
    messages:
      recommendationMessage:
        description: Event containing personalized recommendations
        payload:
          type: object
          required: [userId, recommendedVideos]
          properties:
            userId:
              type: string
            recommendedVideos:
              type: array
              items:
                type: object
                properties:
                  videoId:
                    type: string
                  title:
                    type: string
                  genre:
                    type: string

  videoNewRelease:
    address: 'video/new_release'
    messages:
      newReleaseMessage:
        description: Notification for new video releases
        payload:
          type: object
          required: [title, releaseDate]
          properties:
            title:
              type: string
            releaseDate:
              type: string
              format: date
            category:
              type: string

  videoQuality:
    address: 'video/quality_change'
    messages:
      qualityChangeMessage:
        description: Adaptive bitrate streaming quality change event
        payload:
          type: object
          required: [userId, videoId, fromQuality, toQuality, timestamp]
          properties:
            userId:
              type: string
            videoId:
              type: string
            fromQuality:
              type: string
            toQuality:
              type: string
            timestamp:
              type: string
              format: date-time

operations:
  publishPlaybackEvent:
    action: send
    channel:
      $ref: '#/channels/videoPlayback'

  publishRecommendation:
    action: send
    channel:
      $ref: '#/channels/videoRecommendation'

  publishNewRelease:
    action: send
    channel:
      $ref: '#/channels/videoNewRelease'

  publishQualityChange:
    action: send
    channel:
      $ref: '#/channels/videoQuality'